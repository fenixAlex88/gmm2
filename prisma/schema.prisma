generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Article {
  id          Int       @id @default(autoincrement())
  title       String
  imageUrl    String?
  contentHtml String
  views       Int       @default(0)
  likes       Int       @default(0) // Счетчик лайков
  updatedAt   DateTime  @updatedAt @default(now())
  
  authorId    Int?
  author      Author?   @relation(fields: [authorId], references: [id])
  
  tags        Tag[]
  
  // Связь с субъектами (о ком)
  subjects    Subject[] 
  
  // Связь с местами
  places      Place[]   

  sectionId   Int
  section     Section   @relation(fields: [sectionId], references: [id])
  comments    Comment[]

  @@map("articles")
}

model Subject {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  articles Article[]

  @@map("subjects")
}

model Place {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  articles Article[]

  @@map("places")
}

model Author {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  avatar   String?
  articles Article[]

  @@map("authors")
}

model Tag {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  articles Article[]

  @@map("tags")
}

model Section {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  articles Article[]

  @@map("sections")
}

model Comment {
  id         Int      @id @default(autoincrement())
  content    String   @db.Text
  createdAt  DateTime @default(now())
  
  // Данные из Google (NextAuth)
  authorName   String
  authorImage  String?
  authorEmail  String   // Полезно для идентификации, если нужно

  articleId  Int
  article    Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@map("comments")
}